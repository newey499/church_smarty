<?php

error_reporting(E_ALL);

require_once('php/class.SmartyExtended.php');
require_once('php/class.MysqliExtended.php');
require_once('php/class.Menu.php');
require_once('php/genlib.php');

// Default menu table primary key for home page
$id = '1';

$oMysqli = MysqliExtended::getInstance();

$oSmarty = new SmartyExtended();
//** un-comment the following line to show the debug console
//$oSmarty->debugging = true;
// add directories where plugins are stored
$oSmarty->setPluginsDir('./church_smarty_plugins');

//$oMenuLeft  = new Menu(Menu::LEFT);
//$oSmarty->assign('oMenuLeft', $oMenuLeft->aMenuGroups);

//$oMenuRight = new Menu(Menu::RIGHT);
//$oSmarty->assign('oMenuRight', $oMenuRight->aMenuGroups);

$oSmarty->clearCache('index.tpl');

$oSmarty->assign('app_name', "church_smarty");
$oSmarty->assign('name', "<H1>Chris</H1>");
$oSmarty->assign('lastUpdatedDateTime', getLastUpdateTimestamp());

if (isset($_GET['id']))
{
	try 
	{

		/************
		Ensure $rowid is numeric and an integer
		********************/
		if (! checkIsInteger($_GET['id']) )
		{
			throw new InvalidArgumentException("id of (" . $_GET['id']  . ") is not a numeric integer");
		}

		$id = $_GET['id'];	
	} 
	catch (InvalidArgumentException $ex) 
	{
		// Revert to home page
		$id = '1';
		$oSmarty->assign('menusTablePrimaryKeyId', "Invalid argument exception [" . $ex->getMessage() . "] - redirected to Home page");		
	}

}
else 
{
	$oSmarty->assign('menusTablePrimaryKeyId', "Not Set: default to [1] (Home Page)");
	// Revert to home page
	$id = '1';	
}

$oSmarty->assign('menusTablePrimaryKeyId', $id);	
$centreColumnContent = Menu::getMenuItemContent($id);
$oSmarty->assign('centreColumnContent', $centreColumnContent);

//require_once('php/header.php');

// ========= Start Smarty generated content =========
$oSmarty->display('index.tpl');
// ========= End Smarty generated content   =========

//require_once('php/footer.php');

?>
